<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <style>
    .dashboard-card {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04);
      border: 1px solid #e2e8f0;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .dashboard-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
    }
    .profile-gradient {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    }
    .notification-gradient {
      background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
    }
    .courses-gradient {
      background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
    }
    .attendance-gradient {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    .compact-table {
      font-size: 0.875rem;
    }
    .compact-table th {
      padding: 0.75rem 0.5rem;
    }
    .compact-table td {
      padding: 0.625rem 0.5rem;
    }
    .attendance-high {
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      color: #166534;
      border: 1px solid #a7f3d0;
    }
    .attendance-low {
      background: linear-gradient(135deg, #fef2f2, #fecaca);
      color: #dc2626;
      border: 1px solid #fca5a5;
    }
    .recommendation-box {
      font-size: 0.75rem;
      padding: 0.375rem 0.5rem;
      border-radius: 0.375rem;
      font-weight: 600;
      text-align: center;
    }
    .need-attend {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      color: #92400e;
      border: 1px solid #f3cc30;
    }
    .can-bunk {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      color: #065f46;
      border: 1px solid #6ee7b7;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-100 via-blue-50 to-indigo-100 min-h-screen">

  <div class="container mx-auto px-4 py-6 max-w-7xl">
    
    <!-- Compact Header -->
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800 mb-1">
        <i class="fas fa-graduation-cap text-indigo-600 mr-2"></i>
        Student Dashboard
      </h1>
      <p class="text-gray-600 text-sm">Academic Progress Overview</p>
    </div>

    <!-- Compact Dashboard Grid -->
    <div class="grid grid-cols-12 gap-4">

      <!-- Compact Profile Card -->
      <div class="col-span-12 lg:col-span-3">
        <div class="dashboard-card rounded-xl overflow-hidden">
          <div class="profile-gradient text-white p-4">
            <div class="flex items-center">
              <div class="bg-white bg-opacity-20 p-2 rounded-lg mr-3">
                <i class="fas fa-user text-lg"></i>
              </div>
              <div>
                <h2 class="text-lg font-bold">Profile</h2>
                <p class="text-indigo-100 text-xs">Student Info</p>
              </div>
            </div>
          </div>
          
          <div class="p-4 space-y-3">
            <div class="grid grid-cols-1 gap-2">
              <div class="flex items-center p-2 bg-gray-50 rounded-md">
                <i class="fas fa-id-card text-indigo-600 w-4 mr-2 text-sm"></i>
                <div class="flex-1">
                  <span class="text-gray-500 text-xs">Reg No</span>
                  <p class="font-semibold text-sm">{{ profile.regno }}</p>
                </div>
              </div>
              
              <div class="flex items-center p-2 bg-gray-50 rounded-md">
                <i class="fas fa-birthday-cake text-purple-600 w-4 mr-2 text-sm"></i>
                <div class="flex-1">
                  <span class="text-gray-500 text-xs">DOB</span>
                  <p class="font-semibold text-sm">{{ profile.dob }}</p>
                </div>
              </div>
              
              <div class="flex items-center p-2 bg-gray-50 rounded-md">
                <i class="fas fa-graduation-cap text-green-600 w-4 mr-2 text-sm"></i>
                <div class="flex-1">
                  <span class="text-gray-500 text-xs">Program</span>
                  <p class="font-semibold text-sm">{{ profile.program }}</p>
                </div>
              </div>
              
              <div class="flex items-center p-2 bg-gray-50 rounded-md">
                <i class="fas fa-envelope text-red-600 w-4 mr-2 text-sm"></i>
                <div class="flex-1">
                  <span class="text-gray-500 text-xs">Email</span>
                  <p class="font-semibold text-xs">{{ profile.email }}</p>
                </div>
              </div>
              
              <div class="flex items-center p-2 bg-gray-50 rounded-md">
                <i class="fas fa-phone text-orange-600 w-4 mr-2 text-sm"></i>
                <div class="flex-1">
                  <span class="text-gray-500 text-xs">Mobile</span>
                  <p class="font-semibold text-sm">{{ profile.mobile }}</p>
                </div>
              </div>
              
              <div class="flex items-center p-2 bg-gradient-to-r from-yellow-100 to-yellow-200 rounded-md border border-yellow-300">
                <i class="fas fa-chart-line text-yellow-700 w-4 mr-2 text-sm"></i>
                <div class="flex-1">
                  <span class="text-yellow-700 text-xs font-medium">CGPA</span>
                  <p class="font-bold text-lg text-yellow-800">{{ profile.cgpa }}</p>
                </div>
              </div>
            </div>
            
            <form action="{{ url_for('logout') }}" method="get" class="pt-3">
              <button class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 font-semibold text-sm shadow-lg">
                <i class="fas fa-sign-out-alt mr-1"></i>Logout
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Compact Notifications Card -->
      <div class="col-span-12 lg:col-span-9">
        <div class="dashboard-card rounded-xl overflow-hidden">
          <div class="notification-gradient text-white p-4">
            <div class="flex items-center">
              <div class="bg-white bg-opacity-20 p-2 rounded-lg mr-3">
                <i class="fas fa-bell text-lg"></i>
              </div>
              <div>
                <h3 class="text-lg font-bold">Notifications</h3>
                <p class="text-orange-100 text-xs">Recent updates</p>
              </div>
            </div>
          </div>
          
          <div class="p-4">
            {% if profile.notifications %}
              <div class="space-y-3">
                {% for note in profile.notifications[:3] %}
                  <div class="bg-gradient-to-r from-white to-gray-50 border border-gray-200 p-3 rounded-lg shadow-sm">
                    <div class="flex items-start justify-between mb-1">
                      <div class="flex items-center">
                        <div class="bg-blue-100 p-1.5 rounded-full mr-2">
                          <i class="fas fa-user-tie text-blue-600 text-xs"></i>
                        </div>
                        <div>
                          <span class="font-bold text-blue-700 text-sm">{{ note.by }}</span>
                          <p class="text-xs text-gray-500">{{ note.datetime }}</p>
                        </div>
                      </div>
                      <i class="fas fa-exclamation-circle text-orange-500 text-sm"></i>
                    </div>
                    <div class="ml-8 text-gray-800 text-sm leading-relaxed whitespace-pre-wrap">{{ note.message }}</div>
                  </div>
                {% endfor %}
                {% if profile.notifications|length > 3 %}
                  <div class="text-center pt-2">
                    <span class="text-xs text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                      <i class="fas fa-plus mr-1"></i>{{ profile.notifications|length - 3 }} more
                    </span>
                  </div>
                {% endif %}
              </div>
            {% else %}
              <div class="text-center py-8">
                <i class="fas fa-bell-slash text-gray-300 text-3xl mb-3"></i>
                <p class="text-gray-500 text-sm">No notifications available</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Compact Completed Courses Card -->
      <div class="col-span-12">
        <div class="dashboard-card rounded-xl overflow-hidden">
          <div class="courses-gradient text-white p-4">
            <div class="flex items-center">
              <div class="bg-white bg-opacity-20 p-2 rounded-lg mr-3">
                <i class="fas fa-book-open text-lg"></i>
              </div>
              <div>
                <h3 class="text-lg font-bold">Completed Courses</h3>
                <p class="text-blue-100 text-xs">Academic achievements</p>
              </div>
            </div>
          </div>
          
          <div class="p-4">
            {% if profile.courses %}
              <div class="overflow-x-auto">
                <table class="w-full compact-table">
                  <thead>
                    <tr class="bg-gradient-to-r from-blue-50 to-cyan-50 border-b border-blue-200">
                      <th class="text-left font-bold text-blue-800">
                        <i class="fas fa-code mr-1"></i>Code
                      </th>
                      <th class="text-left font-bold text-blue-800">
                        <i class="fas fa-book mr-1"></i>Course Name
                      </th>
                      <th class="text-left font-bold text-blue-800">
                        <i class="fas fa-award mr-1"></i>Grade
                      </th>
                      <th class="text-left font-bold text-blue-800">
                        <i class="fas fa-calendar mr-1"></i>Date
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for course in profile.courses %}
                      <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200">
                        <td class="font-semibold text-gray-800">{{ course.code }}</td>
                        <td class="text-gray-700">{{ course.name }}</td>
                        <td>
                          <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold">
                            {{ course.grade }}
                          </span>
                        </td>
                        <td class="text-gray-600">{{ course.month_year }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="text-center py-8">
                <i class="fas fa-book text-gray-300 text-3xl mb-3"></i>
                <p class="text-gray-500 text-sm">No courses available</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Enhanced Attendance Summary Card -->
      <div class="col-span-12">
        <div class="dashboard-card rounded-xl overflow-hidden">
          <div class="attendance-gradient text-white p-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="bg-white bg-opacity-20 p-2 rounded-lg mr-3">
                  <i class="fas fa-calendar-check text-lg"></i>
                </div>
                <div>
                  <h3 class="text-lg font-bold">Attendance Summary</h3>
                  <p class="text-green-100 text-xs">Smart attendance tracking</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-xs text-green-100">Target: 80%</p>
                <p class="text-xs text-green-200">
                  <i class="fas fa-info-circle mr-1"></i>Smart recommendations
                </p>
              </div>
            </div>
          </div>
          
          <div class="p-4">
            {% if profile.attendance %}
              <div class="overflow-x-auto">
                <table class="w-full compact-table">
                  <thead>
                    <tr class="bg-gradient-to-r from-green-50 to-teal-50 border-b border-green-200">
                      <th class="text-left font-bold text-green-800">
                        <i class="fas fa-code mr-1"></i>Code
                      </th>
                      <th class="text-left font-bold text-green-800">
                        <i class="fas fa-chalkboard-teacher mr-1"></i>Course
                      </th>
                      <th class="text-left font-bold text-green-800">
                        <i class="fas fa-users mr-1"></i>Total
                      </th>
                      <th class="text-left font-bold text-green-800">
                        <i class="fas fa-clock mr-1"></i>Attended
                      </th>
                      <th class="text-left font-bold text-green-800">
                        <i class="fas fa-percentage mr-1"></i>%
                      </th>
                      <th class="text-left font-bold text-green-800">
                        <i class="fas fa-lightbulb mr-1"></i>Action
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for att in profile.attendance %}
                      <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200">
                        <td class="font-semibold text-gray-800">{{ att.code }}</td>
                        <td class="text-gray-700">{{ att.name }}</td>
                        <td class="text-gray-600">{{ att.total_class }}</td>
                        <td class="text-gray-600">{{ att.class_attended }}</td>
                        <td>
                          {% set percentage = att.percentage|replace('%', '')|float %}
                          {% if percentage >= 80 %}
                            <span class="attendance-high px-2 py-1 rounded-full text-xs font-bold">
                              {{ att.percentage }}
                            </span>
                          {% else %}
                            <span class="attendance-low px-2 py-1 rounded-full text-xs font-bold">
                              {{ att.percentage }}
                            </span>
                          {% endif %}
                        </td>
                        <td>
                          {% set current_classes = att.total_class|int %}
                          {% set attended_classes = (current_classes * percentage / 100)|int %}
                          {% if percentage >= 80 %}
                            {% set future_total = current_classes + 10 %}
                            {% set can_miss = ((attended_classes - (future_total * 0.8))|int) %}
                            {% if can_miss > 0 %}
                              <div class="can-bunk recommendation-box">
                                <i class="fas fa-thumbs-up mr-1"></i>Can bunk {{ can_miss }} classes
                              </div>
                            {% else %}
                              <div class="can-bunk recommendation-box">
                                <i class="fas fa-check-circle mr-1"></i>Safe zone
                              </div>
                            {% endif %}
                          {% else %}
                            {% set future_total = current_classes + 15 %}
                            {% set need_attend = ((future_total * 0.8 - attended_classes)|int) %}
                            <div class="need-attend recommendation-box">
                              <i class="fas fa-exclamation-triangle mr-1"></i>Need {{ need_attend }} classes
                            </div>
                          {% endif %}
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              
              <!-- Attendance Legend -->
              <div class="mt-4 flex flex-wrap gap-3 text-xs">
                <div class="flex items-center">
                  <span class="w-3 h-3 bg-green-200 border border-green-400 rounded-full mr-1"></span>
                  <span class="text-gray-600">≥80% (Safe)</span>
                </div>
                <div class="flex items-center">
                  <span class="w-3 h-3 bg-red-200 border border-red-400 rounded-full mr-1"></span>
                  <span class="text-gray-600">&lt;80% (At Risk)</span>
                </div>
                <div class="flex items-center">
                  <span class="w-3 h-3 bg-yellow-200 border border-yellow-400 rounded-full mr-1"></span>
                  <span class="text-gray-600">Classes to attend</span>
                </div>
                <div class="flex items-center">
                  <span class="w-3 h-3 bg-blue-200 border border-blue-400 rounded-full mr-1"></span>
                  <span class="text-gray-600">Classes can bunk</span>
                </div>
              </div>
            {% else %}
              <div class="text-center py-8">
                <i class="fas fa-calendar-times text-gray-300 text-3xl mb-3"></i>
                <p class="text-gray-500 text-sm">No attendance data available</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Enhanced interactivity and animations
    document.addEventListener('DOMContentLoaded', function() {
      // Smooth fade-in animation for cards
      const cards = document.querySelectorAll('.dashboard-card');
      cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(15px)';
        setTimeout(() => {
          card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, index * 80);
      });

      // Add tooltip functionality for attendance recommendations
      const recommendations = document.querySelectorAll('.recommendation-box');
      recommendations.forEach(rec => {
        rec.addEventListener('mouseenter', function() {
          this.style.transform = 'scale(1.05)';
          this.style.transition = 'transform 0.2s ease';
        });
        rec.addEventListener('mouseleave', function() {
          this.style.transform = 'scale(1)';
        });
      });

      // Highlight low attendance rows
      const attendanceRows = document.querySelectorAll('tbody tr');
      attendanceRows.forEach(row => {
        const percentageCell = row.querySelector('.attendance-low');
        if (percentageCell) {
          row.style.background = 'linear-gradient(90deg, #fef2f2 0%, #ffffff 100%)';
        }
      });
    });
  </script>

</body>
</html>
